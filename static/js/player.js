class BriefPlayer{constructor(){this.audio=document.getElementById('briefAudio');if(!this.audio)return;this.playBtn=document.getElementById('playBtn');this.waveformContainer=document.querySelector('.waveform-container');this.playbackControls=document.querySelector('.playback-controls');this.progressContainer=document.querySelector('.progress-container');this.progressFill=document.querySelector('.progress-fill');this.progressHandle=document.querySelector('.progress-handle');this.progressBar=document.querySelector('.progress-bar');this.timeDisplay=document.querySelector('.time-display');this.speedBtn=document.querySelector('.speed-btn');this.skipBack=document.querySelector('.skip-back');this.skipForward=document.querySelector('.skip-forward');this.stickyPlayer=document.querySelector('.sticky-player');this.stickyPlayBtn=document.querySelector('.sticky-play-btn');this.stickyTime=document.querySelector('.sticky-time');this.stickyProgressFill=document.querySelector('.sticky-progress-fill');this.stickyProgress=document.querySelector('.sticky-progress');this.stickySpeed=document.querySelector('.sticky-speed');this.stickyWaveform=document.querySelector('.sticky-waveform');this.speeds=[1,1.25,1.5,1.75,2];this.currentSpeedIndex=0;this.isPlaying=false;this.waveformBars=[];this.heroSection=document.querySelector('.hero');this.init()}init(){this.createWaveform();this.bindEvents();this.updateTimeDisplay()}createWaveform(){for(let i=0;i<60;i++){const bar=document.createElement('div');bar.className='waveform-bar';bar.style.height=(Math.random()*40+20)+'px';this.waveformContainer.appendChild(bar);this.waveformBars.push(bar)}for(let i=0;i<40;i++){const bar=document.createElement('div');bar.className='waveform-bar';bar.style.height=(Math.random()*20+5)+'px';bar.style.width='2px';this.stickyWaveform.appendChild(bar)}}bindEvents(){this.playBtn.addEventListener('click',()=>this.togglePlay());this.stickyPlayBtn.addEventListener('click',()=>this.togglePlay());this.audio.addEventListener('timeupdate',()=>this.onTimeUpdate());this.audio.addEventListener('loadedmetadata',()=>this.updateTimeDisplay());this.audio.addEventListener('ended',()=>this.onEnded());this.audio.addEventListener('play',()=>this.onPlay());this.audio.addEventListener('pause',()=>this.onPause());this.progressBar.addEventListener('click',e=>this.seek(e));this.stickyProgress.addEventListener('click',e=>this.seekSticky(e));this.speedBtn.addEventListener('click',()=>this.cycleSpeed());this.stickySpeed.addEventListener('click',()=>this.cycleSpeed());this.skipBack.addEventListener('click',()=>this.skip(-15));this.skipForward.addEventListener('click',()=>this.skip(15));window.addEventListener('scroll',()=>this.handleScroll())}togglePlay(){this.audio.paused?this.audio.play():this.audio.pause()}onPlay(){this.isPlaying=true;this.playBtn.classList.add('playing');this.playbackControls.classList.add('visible');this.progressContainer.classList.add('visible');this.animateWaveform()}onPause(){this.isPlaying=false;this.playBtn.classList.remove('playing')}onEnded(){this.isPlaying=false;this.playBtn.classList.remove('playing')}onTimeUpdate(){const progress=(this.audio.currentTime/this.audio.duration)*100;this.progressFill.style.width=progress+'%';this.progressHandle.style.left=progress+'%';this.stickyProgressFill.style.width=progress+'%';this.updateTimeDisplay()}updateTimeDisplay(){const c=this.formatTime(this.audio.currentTime);const d=this.formatTime(this.audio.duration||0);const t=c+' / '+d;this.timeDisplay.textContent=t;this.stickyTime.textContent=t}formatTime(s){if(isNaN(s))return'0:00';const m=Math.floor(s/60);const sec=Math.floor(s%60);return m+':'+sec.toString().padStart(2,'0')}seek(e){const r=this.progressBar.getBoundingClientRect();this.audio.currentTime=((e.clientX-r.left)/r.width)*this.audio.duration}seekSticky(e){const r=this.stickyProgress.getBoundingClientRect();this.audio.currentTime=((e.clientX-r.left)/r.width)*this.audio.duration}skip(s){this.audio.currentTime=Math.max(0,Math.min(this.audio.duration,this.audio.currentTime+s))}cycleSpeed(){this.currentSpeedIndex=(this.currentSpeedIndex+1)%this.speeds.length;const s=this.speeds[this.currentSpeedIndex];this.audio.playbackRate=s;this.speedBtn.textContent=s+'x';this.stickySpeed.textContent=s+'x'}handleScroll(){const h=this.heroSection.getBoundingClientRect().bottom;h<0&&this.isPlaying?this.stickyPlayer.classList.add('visible'):this.stickyPlayer.classList.remove('visible')}animateWaveform(){if(!this.isPlaying)return;this.waveformBars.forEach(b=>{b.style.height=(Math.random()*50+10)+'px';b.classList.add('active')});this.stickyWaveform.querySelectorAll('.waveform-bar').forEach(b=>b.style.height=(Math.random()*20+5)+'px');requestAnimationFrame(()=>setTimeout(()=>this.animateWaveform(),100))}}document.addEventListener('DOMContentLoaded',()=>new BriefPlayer());
